name: CI / Trigger internal test

on:
  workflow_call:
    inputs:
      ref:
        description: "ref to checkout"
        required: false
        type: string

  get-compiler-version:
    uses: ./.github/workflows/rbln_utils_get_compiler_version_ci.yaml
    secrets: inherit

  get-optimum-version:
    uses: ./.github/workflows/rbln_utils_get_optimum_version_ci.yaml
    secrets: inherit

  vllm-rbln-pytest:
    needs: [get-compiler-version, get-optimum-version]
    uses: ./.github/workflows/rbln_vllm-rbln_pytest.yaml
    secrets: inherit
    with:
      ref: ${{ inputs.ref }}
      rebel_compiler_version: ${{ needs.get-compiler-version.outputs.compiler_version }}
      optimum_rbln_version: ${{ needs.get-optimum-version.outputs.optimum_version }}

  vllm-rbln-optimum-ci:
    needs: [get-compiler-version, get-optimum-version]
    uses: ./.github/workflows/rbln_optimum_ci.yaml
    secrets: inherit
    with:
      ref: ${{ inputs.ref }}
      rebel_compiler_version: ${{ needs.get-compiler-version.outputs.compiler_version }}
      optimum_rbln_version: ${{ needs.get-optimum-version.outputs.optimum_version }}
